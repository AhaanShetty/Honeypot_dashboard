{% extends 'base.html' %}

{% block head %}
<title>Correlation</title>
{% endblock %}

{% block body %}
<div class="dashboard-wrapper">
    <div class="dashboard-ecommerce">
        <div class="container-fluid dashboard-content ">
            <div class="row">
                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                    <div class="page-header">
                        <h2 class="pageheader-title">Proposed Alert Correlation Framework</h2>
                        
                    </div>
                </div>
            </div>
            <div class="ecommerce-widget">

                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <h3 class="text-muted card-header">Introduction</h3>
                            <div class="card-body">
                                <div class="chart">
                                    <p style="font-size: 15px;">
                                        We had installed Snort and Suricata honeypots to capture attacks. These honeypots sniff each network packet and based on the rules specified, either create an alert for that packet or pass them.<br>
                                        The same type of attack, caused by the same IP address multiple times, creates different alerts. Thus, the number of alerts generated is huge and it becomes difficult for sys-admin to draw inferences from logs only.<br>
                                        If an attacker causes an attack in multiple steps, each of its steps causes different alerts to be generated. The IDS does not relate them even if they are coming from the same IP and going to the same IP and stores them as independent alerts in the log file.<br>
                                        To address the above issues, we have the following proposed an Alert Correlation system.
                                    </p>
                                    <img src="{{ url_for('static',filename='images/correlation_system.png') }}">
                                </div>
                                
                            </div>
                            
                        </div>
                    </div>
                </div> 
                <!-- Alerts correlation and Aggregation    -->
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <a class="card-link" data-toggle="collapse" href="#alertagg">
                                    <h4 class="text-muted">Alerts Aggregation</h4>
                                </a>
                            </div>
                            <div id="alertagg" class="collapse">
                                <div class="card-body">
                                    All alerts generated by the honeypots are normalized and stored in a CSV file with selected features to be used for Correlation. These alerts are aggregated to form 1 hyperalert if they are of the same attack type and occur within a period of time(say 1 min).
                                </div>
                            </div>
                        </div>
                            
                    </div>
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <a class="card-link" data-toggle="collapse" href="#alertcorr">
                                    <h4 class="text-muted">Alerts Correlation</h4>
                                </a>
                            </div>
                            <div id="alertcorr" class="collapse">
                                <div class="card-body">
                                    Two hyperalerts can be correlated (A -> B) if <br>
                                    <ul>
                                        <li>(A -> B) occur within a specified time frame(say 5 mins) in the same order</li>
                                        <li>correlativity(A -> B) >= correlation_threshold (say 0.5)</li>
                                    </ul>
                                    <div style="background-color: #efeff6; border: 0.5px solid #efeff6;">
                                        <p style="margin-left: 10px;margin-top: 10px;margin-bottom: 10px;">
                                            correlativity(A -> B)    =    w1 * similarity(A -> B) * confidence(A, B) + w2 * ccm(A, B) <br>
                                        </p>
                                    </div><br>
                                    Here, <br>
                                    <ul>
                                        <li>w1,w2 => predefined weights for weighted sum</li>
                                        <li>similarity(A -> B) = sim(source_ip) + sim(source_port) + sim(dest_ip) + sim(dest_port)</li>
                                        <li>confidence(A, B)   =   Frequency of (A, B) / Frequency of (A)</li>
                                        (Confidence gives the idea that how many times B follows A)
                                        <li>ccm(A, B) = corresponding value in CCM matrix for hyperalerts (A, B)</li>
                                        (If it is known that A and B are strongly related, then ccm(A, B) = 0.5, else less)
                                    </ul>
                                </div>
                            </div>
                        </div>
                            
                    </div>
                </div>
                
                <!-- Results and Discussion -->
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <h3 class="text-muted card-header">Results and Discussion</h3>
                            <div class="card-body">
                                <div class="chart">
                                    <p style="font-size: 15px;">
                                        We performed correlation on two datasets<br>
                                        1 ) DARPA 2000 Inside dataset<br>
                                        2 ) Snort dataset collected by our honeypot on AWS<br>
                                        <h4> DARPA 2000 Inside dataset</h4>
                                        Pcap file was downloaded from <a href="https://archive.ll.mit.edu/ideval/data/2000/LLS_DDOS_1.0.html">DARPA IDS Dataset</a><br>
                                        This pcap file was given as input to Snort IDS which generated alerts in a csv file which was used as input to our system<br>
                                        <br>
                                        <table class="table table-bordered table-hover table-condensed">
                                            <thead>
                                                <tr>
                                                    <th>Raw Alerts</th>
                                                    <th>Hyperalerts</th>
                                                    <th>Pseudo-attack links</th>
                                                    <th>Correlations</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                   <td>922</td>
                                                   <td>323</td>
                                                   <td>518</td>
                                                   <td>1959</td>
                                                </tr>
                                            </tbody>
                                        </table><br>
                                        This dataset contains the LLS_DOS 1.0 attack scenario of which almost all correlated steps are successfully detected by our system.<br>
                                        Here,<br>
                                        M1, M2, M3, M4, M5, M6, M7, M8 => IP addresses<br>
                                        Values adjacent to the links => Correlativity values between the 2 hyperalerts (higher the value, more strongly correlated)<br>
                                        S => Source IP	&nbsp; &nbsp; &nbsp; &nbsp;	D => Destination IP<br><br>
                                        <img src="{{ url_for('static',filename='images/LLSDOS_own_system.png') }}" style="display: block;margin-left: auto;margin-right: auto;"><br>
                                        <p style="text-align: center;">LLSDOS 1.0 attack scenario detected by our system</p><br>
                                        <img src="{{ url_for('static',filename='images/LLSDOS_research paper.png') }}" style="display: block;margin-left: auto;margin-right: auto;"><br>
                                        <p style="text-align: center;">LLSDOS 1.0 detected by RTECA: Real time episode correlation research paper</p>
                                        <hr>
                                        <h4> Snort dataset collected by our honeypot on AWS</h4>
                                        Snort honeypot was installed on AWS and alerts generated were stored in a csv file. The dataset was collected for more than 30 days and contains ~45000 raw alerts and processing these many alerts takes a huge amount of time. So, for testing purposes, we have tested using alerts collected in the first 10 days ~25000 alerts.<br>
                                        For this dataset, we did not have a proper knowledge base to create a causal correlation matrix. So, we have not used ccm values here.<br>
                                        Here are some parts of the correlation graph :<br><br>
                                        <img src="{{ url_for('static',filename='images/aws_graph1.png') }}" style="display: block;margin-left: auto;margin-right: auto;border: 1px solid grey;"><br><br>
                                        For 20000 raw alerts, it is difficult to visualize in the graph, so for displaying the graph, we have used very less number of alerts<br><br>
                                        <img src="{{ url_for('static',filename='images/aws_graph2.png') }}" style="display: block;margin-left: auto;margin-right: auto;border: 1px solid grey;"><br><br>
                                        Correlativity values are ~ 1.00 because of fewer alerts, confidence=1.00 even if they occur together only once<br>
                                    </p>
                                    
                                </div>
                                
                            </div>
                            
                        </div>
                    </div>
                </div>
                <!-- Prediction of next step -->
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <h3 class="text-muted card-header">Prediction of the next step of a multi-step attack</h3>
                            <div class="card-body">
                                <div class="chart">
                                    <p style="font-size: 15px;">
                                        This module can be used in real-time after we have prepared the correlation graphs in the offline mode from the dataset of previously generated alerts.<br>
                                        The prediction module predicts the next step of an attacker if the previous step is a part of a multi-step attack.<br>
                                        The process goes like this :
                                        <ul>
                                            <li>A step of an attacker is captured as an alert by the IDS</li>
                                            <li>This alert is mapped in the correlation graph. If it is found in the graph and there are alerts correlated to it, then these alerts are considered for the next processing.</li>
                                            <li>All alerts correlated to it in the forward direction (i.e. if ‘A’ is captured and there are correlations like A->B, A->C, A->D, then B, C, D alerts) are considered for calculating the probability of occurrence. Probability for each correlated alert is calculated as,</li>
                                        </ul>
                                        <div style="background-color: #efeff6; border: 0.5px solid #efeff6;">
                                            <p style="margin-left: 10px;margin-top: 10px;margin-bottom: 10px;">
                                                Probability(B | A) &nbsp;	= &nbsp;	(No. of occurrences of correlation A->B)  /  <br>
                                                (Probability of B	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(No. of occurrences of correlation A->*)<br>
                                                occurring when A <br>
                                                has occured)<br>
                                            </p>
                                        </div><br>
                                        Here, (A->*) means all correlations which start with A<br>
                                        The probability of whichever alert is greater than the probabilities of other alerts will be predicted as the next step.<br>
                                        Testing of Prediction module : Using the same DARPA 2000 dataset<br>
                                        A set of alerts that have already occurred are given as input to the Prediction module in a file. The module selects the last alert, calculates the probabilities of all its correlated alerts and displays them as:<br><br>
                                        <img src="{{ url_for('static',filename='images/prediction.png') }}"><br><br>
                                        Here, the input alert was :<br>
                                        Attack_type = Sadmind_Ping<br>
                                        Source_IP = 202.77.162.213 (M2)<br>
                                        Destination_IP = 172.16.112.50 (M1)<br><br>
                                        As we can see in the above correlation graph of LLDOS 1.0 captured by our system, correlated alerts to this alert and their probabilities are<br>
                                        <ol>
                                            <li>Admind S=M2 D=M1 &emsp; &emsp; &emsp; &emsp; &thinsp; P(Admind | Sadmind_Ping) = 0.04</li>
                                            <li>SAO S=M2 &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp; &emsp;D=M1P(SAO | Sadmind_Ping) = 0.16</li>
                                            <li>Mstream_Zombie S=M1 D=M7 &nbsp; &nbsp; P(Mstream_Zombie | Sadmind_Ping) = 0.04</li>
                                        </ol>
                                        Thus, we can say that Sadmind_Amslverify_Overflow(SAO) will be the next step.
                                    </p>
                                    
                                </div>
                                
                            </div>
                            
                        </div>
                    </div>
                </div>
                <!-- Limitations -->
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <h3 class="text-muted card-header">Limitations/Problems faced</h3>
                            <div class="card-body" style="padding-top: 0px;">
                                <div class="chart">
                                    <p style="font-size: 15px;">
                                        <ol>
                                            <li>The knowledge base was available for the DARPA 2000 dataset which has alerts of 19 attack types. But for other alert types, the knowledge base is not available. So the Causal Correlation Matrix cannot be used for other alerts.</li>
                                            <li>If less number of alerts are used for creating the correlation graph, then the number of false positives increases (as confidence becomes 1 even if the pair of alerts occur once together).</li>
                                            <li>Offline processing of alerts to create a correlation graph takes a huge time if the number of alerts is huge. (Implementation of the system is done in Java)</li>
                                        </ol>
                                    </p>
                                </div>
                                
                            </div>
                            
                        </div>
                    </div>
                </div> 
                
            </div>
        </div>
    </div>
</div>
{% endblock %}

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <!-- Plotly.js -->
    <script src="https://d14fo0winaifog.cloudfront.net/plotly-basic.js"></script>